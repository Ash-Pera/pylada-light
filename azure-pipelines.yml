pool:
  vmImage: macos-10.13

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: 3.6
      architecture: x64

  - script: |
      brew install gcc
    name: setup

  - script: |
      python3 -m pip install .[dev]
    name: build

  - script: |
      cd tests
      python3 -m pytests --junitxml=junit/pytest.xml \
          --cov=src/muse \
          --cov-report=xml:coverage/coverage.xml \
          --cov-report=html:coverage
    name: test_with_coverage

  - task: PublishTestResults@2
    inputs:
      testResultsFiles: junit/*.xml
      testRunTitle: '$(Agent.OS) - $(Build.BuildNumber)[$(Agent.JobName)]'
    condition: succeededOrFailed()

  - task: PublishCodeCoverageResults@1
    inputs:
      codeCoverageTool: cobertura
      summaryFileLocation: coverage/coverage.xml
      reportDirectory: coverage
